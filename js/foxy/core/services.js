import { normalize } from "../core/utils.js";

// üíÖ –£—Å–ª—É–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
export const services = {
  "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä":       "–°–Ω—è—Ç–∏–µ + –∫–æ–º–±–∏-–º–∞–Ω–∏–∫—é—Ä ‚Äî 1000‚ÇΩ.",
  "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º": "–°–Ω—è—Ç–∏–µ + –∫–æ–º–±–∏ + —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ + –¥–∏–∑–∞–π–Ω ‚Äî –æ—Ç 1700‚ÇΩ.",
  "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã":     "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã –∏ —Ñ–æ—Ä–º—ã ‚Äî –æ—Ç 2100‚ÇΩ.",
  "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π":  "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ + –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Äî 3000‚ÇΩ.",
  "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è":     "–°–Ω—è—Ç–∏–µ –±–µ–∑ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è ‚Äî 500‚ÇΩ."
};

// üîÅ –°–∏–Ω–æ–Ω–∏–º—ã –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
const aliases = {
  "–∫–æ–º–±–∏": "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä",
  "–º–∞–Ω–∏–∫—é—Ä": "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä",
  "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ": "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º",
  "–ø–æ–∫—Ä—ã—Ç–∏–µ": "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º",
  "–¥–ª–∏–Ω–∞": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–¥–ª–∏–Ω—É": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–Ω–∞—Ä–∞—Å—Ç–∏—Ç—å": "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π",
  "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ": "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π",
  "—Å–Ω—è—Ç–∏–µ": "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è",
  "—Å–Ω—è—Ç—å": "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è"
};

// üõë –ú—è–≥–∫–∏–π —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ–º—ã—Ö —Ñ—Ä–∞–∑
const stopWords = [
  "–∫–∞–∫ –¥–µ–ª–∞", "—á—Ç–æ —Ç—ã", "–∫—Ç–æ —Ç—ã", "–¥–∏–∑–∞–π–Ω",
  "—É—Å–ª—É–≥–∏", "–ø–æ–º–æ–≥–∏", "–ø–æ–º–æ—â—å", "–Ω–µ –∑–Ω–∞—é", "—Ä–∞—Å—Å–∫–∞–∂–∏"
];

/**
 * –ü–æ–∏—Å–∫ —É—Å–ª—É–≥–∏ –ø–æ —Ç–µ–∫—Å—Ç—É ‚Äî –ª–æ–≤–∏–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ—Ä–∞–∑—ã
 */
export function matchService(text) {
  const input = normalize(text);

  // 1) –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
  if (stopWords.some(w => input === normalize(w))) {
    console.log("üõë —Å—Ç–æ–ø-—Å–ª–æ–≤–æ –≤ matchService:", input);
    return null;
  }

  // 2) –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∞–ª–∏–∞—Å–∞–º (—Å–∏–Ω–æ–Ω–∏–º–∞–º)
  for (const [alias, serviceName] of Object.entries(aliases)) {
    const normAlias = normalize(alias);
    if (input.includes(normAlias)) {
      return { name: serviceName, exact: false };
    }
  }

  // 3) –ó–∞—Ç–µ–º ‚Äî –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏—è–º —É—Å–ª—É–≥
  for (const serviceName of Object.keys(services)) {
    const normKey = normalize(serviceName);
    if (input.includes(normKey)) {
      return { name: serviceName, exact: true };
    }
  }

  return null;
}

// üí¨ –û—Ç–≤–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
export const replies = {
  greeting: [
    "–ü—Ä–∏–≤–µ—Ç–∏–∫! –ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Å–µ–≥–æ–¥–Ω—è ‚Äî –Ω—é–¥, –±–ª—ë—Å—Ç–∫–∏ –∏–ª–∏ –∫–æ—à–∞—á–∏–π –≥–ª–∞–∑? üòò",
    "–°–∞–ª—é—Ç! –î–∞–≤–∞–π –≤—ã–±–µ—Ä–µ–º —á—Ç–æ-—Ç–æ —Å—Ç–∏–ª—å–Ω–æ–µ –≤–º–µ—Å—Ç–µ üåà"
  ],
  smalltalkLite: [
    "–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ üòä",
    "–í—Å–µ —Å—É–ø–µ—Ä! –ê –∫–∞–∫ –≤–∞—à–∏ –Ω–æ–≥–æ—Ç–∫–∏ —Å–µ–≥–æ–¥–Ω—è? üíÖ"
  ],
  mood: [
    "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Å–ø—Ä–æ—Å–∏–ª–∏! –£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ üíÖ",
    "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚Äî –∫–∞–∫ —Å–≤–µ–∂–∏–π –º–∞–Ω–∏–∫—é—Ä ‚ú®"
  ],
  thanks: [
    "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ üòä",
    "–û–±—Ä–∞—â–∞–π—Å—è –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è üå∏"
  ],
  bye: [
    "–î–æ –≤—Å—Ç—Ä–µ—á–∏! –ù–µ –∑–∞–±—ã–≤–∞–π –±–∞–ª–æ–≤–∞—Ç—å —Å–µ–±—è ‚ú®",
    "–ü–æ–∫–∞-–ø–æ–∫–∞! –ë—É–¥—É –∂–¥–∞—Ç—å üíñ"
  ],
  design: [
    "–î–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–æ–º –Ω–æ–≥—Ç–µ–π –∑–∞–≥–ª—è–Ω–∏ —Å—é–¥–∞: <a href=\"https://pin.it/2FsXp2Lb5\" class=\"text-pink-500 underline\">Pinterest</a>"
  ],
  fallback: [
    "–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª–∞‚Ä¶ –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å üôà"
  ]
};

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–Ω—Ç–∞
 */
export function randomReply(type) {
  const arr = replies[type] || replies.fallback;
  return arr[Math.floor(Math.random() * arr.length)];
}

/**
 * –≠–º–æ–¥–∑–∏ –§–æ–∫—Å–∏ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é)
 */
export function emoji(mood = "neutral") {
  return "ü¶ä";
}
