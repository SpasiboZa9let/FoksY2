import { normalize } from "../core/utils.js";

// üíÖ –£—Å–ª—É–≥–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
export const services = {
  "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä":       "–°–Ω—è—Ç–∏–µ + –∫–æ–º–±–∏-–º–∞–Ω–∏–∫—é—Ä ‚Äî 1000‚ÇΩ.",
  "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º": "–°–Ω—è—Ç–∏–µ + –∫–æ–º–±–∏ + —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ + –¥–∏–∑–∞–π–Ω ‚Äî –æ—Ç 1700‚ÇΩ.",
  "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã":     "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã –∏ —Ñ–æ—Ä–º—ã ‚Äî –æ—Ç 2100‚ÇΩ.",
  "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π":  "–ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ + –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Äî 3000‚ÇΩ.",
  "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è":     "–°–Ω—è—Ç–∏–µ –±–µ–∑ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è ‚Äî 500‚ÇΩ."
};

// üîÅ –°–∏–Ω–æ–Ω–∏–º—ã –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
const aliases = {
  "–∫–æ–º–±–∏": "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä",
  "–º–∞–Ω–∏–∫—é—Ä": "–∫–æ–º–±–∏ –º–∞–Ω–∏–∫—é—Ä",
  "—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ": "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º",
  "–ø–æ–∫—Ä—ã—Ç–∏–µ": "–º–∞–Ω–∏–∫—é—Ä —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º",
  "–¥–ª–∏–Ω–∞": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–¥–ª–∏–Ω—É": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è": "–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–ª–∏–Ω—ã",
  "–Ω–∞—Ä–∞—Å—Ç–∏—Ç—å": "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π",
  "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ": "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π",
  "—Å–Ω—è—Ç–∏–µ": "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è",
  "—Å–Ω—è—Ç—å": "—Å–Ω—è—Ç–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è"
};

// üõë –ú—è–≥–∫–∏–π —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ–º—ã—Ö —Ñ—Ä–∞–∑
const stopWords = [
  "–∫–∞–∫ –¥–µ–ª–∞", "—á—Ç–æ —Ç—ã", "–∫—Ç–æ —Ç—ã", "–¥–∏–∑–∞–π–Ω",
  "—É—Å–ª—É–≥–∏", "–ø–æ–º–æ–≥–∏", "–ø–æ–º–æ—â—å", "–Ω–µ –∑–Ω–∞—é", "—Ä–∞—Å—Å–∫–∞–∂–∏"
];

/**
 * –ü–æ–∏—Å–∫ —É—Å–ª—É–≥–∏ –ø–æ —Ç–µ–∫—Å—Ç—É ‚Äî –ª–æ–≤–∏–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ—Ä–∞–∑—ã
 */
export function matchService(text) {
  const input = normalize(text);

  // 1) –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
  if (stopWords.some(w => input === normalize(w))) {
    console.log("üõë —Å—Ç–æ–ø-—Å–ª–æ–≤–æ –≤ matchService:", input);
    return null;
  }

  // 2) –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∞–ª–∏–∞—Å–∞–º (—Å–∏–Ω–æ–Ω–∏–º–∞–º)
  for (const [alias, serviceName] of Object.entries(aliases)) {
    const normAlias = normalize(alias);
    if (input.includes(normAlias)) {
      return { name: serviceName, exact: false };
    }
  }

  // 3) –ó–∞—Ç–µ–º ‚Äî –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏—è–º —É—Å–ª—É–≥
  for (const serviceName of Object.keys(services)) {
    const normKey = normalize(serviceName);
    if (input.includes(normKey)) {
      return { name: serviceName, exact: true };
    }
  }

  return null;
}

// üí¨ –û—Ç–≤–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
export const replies = {
  greeting: [
  "–ü—Ä–∏–≤–µ—Ç-–ø—Ä–∏–≤–µ—Ç! üòò –ß–µ–º –ø–æ—Ä–∞–¥–æ–≤–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è?",
  "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π, –∫—Ä–∞—Å–æ—Ç–∫–∞! üíñ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?",
  "–°–∞–ª—é—Ç! –ì–æ—Ç–æ–≤–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É? üåü",
  "–•—ç–π! –§–æ–∫—Å–∏ –Ω–∞ —Å–≤—è–∑–∏ ‚Äî —á—Ç–æ –≤—ã–±–µ—Ä–µ–º? ‚ú®",
  "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ/–¥–µ–Ω—å/–≤–µ—á–µ—Ä! üòä –ß–µ–º –ø–æ–º–æ—á—å?",
  "–ü—Ä–∏–≤–µ—Ç! –¢—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–∞–Ω–∏–∫—é—Ä–∞ üíÖ"
],

  smalltalkLite: [
  "–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ê —É —Ç–µ–±—è –∫–∞–∫? üíÖ",
  "–°—É–ø–µ—Ä! –ì–æ—Ç–æ–≤–∞ —Ç–≤–æ—Ä–∏—Ç—å –∫—Ä–∞—Å–æ—Ç—É –≤–º–µ—Å—Ç–µ —Å —Ç–æ–±–æ–π üòä",
  "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! –ö–∞–∫ –º–æ–≥—É –ø–æ–º–æ—á—å? üå∏",
  "–§–æ–∫—Å–∏ –≤ —É–¥–∞—Ä–µ ‚Äî –¥–∞–≤–∞–π –≤—ã–±–∏—Ä–∞–µ–º –¥–∏–∑–∞–π–Ω! ‚ú®"
],

  mood: [
  "–ö–∞–∫–æ–π —Å–µ–≥–æ–¥–Ω—è –≤–∞–π–±? –ù—é–¥, –±–ª—ë—Å—Ç–∫–∏ –∏–ª–∏ –∫–æ—Å–º–æ—Å? üåå",
  "–í—ã–±–∏—Ä–∞–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: —Å–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –Ω—é–¥ –∏–ª–∏ —Å–º–µ–ª—ã–π –≥–ª–∏—Ç—Ç–µ—Ä? ‚ú®",
  "–°–∫–∞–∂–∏ —Å–ª–æ–≤–æ ‚Äî –ø–æ–¥–±–µ—Ä—É –¥–∏–∑–∞–π–Ω –ø–æ–¥ —Ç–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π! üòâ",
  "–•–æ—á–µ—à—å –Ω–µ–∂–Ω–æ—Å—Ç—å –∏–ª–∏ –¥–µ—Ä–∑–∫–∏–π –±–ª–µ—Å–∫? üéâ"
],

  thanks: [
  "–†–∞–¥–∞ –±—ã–ª–∞ –ø–æ–º–æ—á—å! üå∑",
  "–û–±—Ä–∞—â–∞–π—Å—è, –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—à—å üíñ",
  "–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç—ë–ø–ª—ã–µ —Å–ª–æ–≤–∞! üòä",
  "–í—Å–µ–≥–¥–∞ –∫ —Ç–≤–æ–∏–º —É—Å–ª—É–≥–∞–º! ‚ú®"
],

  bye: [
  "–ü–æ–∫–∞-–ø–æ–∫–∞! –ë—É–¥—É –∂–¥–∞—Ç—å —Ç–µ–±—è —Å–Ω–æ–≤–∞ üíï",
  "–î–æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–∏! –ë–µ—Ä–µ–≥–∏ –Ω–æ–≥–æ—Ç–∫–∏ ‚ú®",
  "–ü—Ä–æ—â–∞–π! –ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ –º–∞–Ω–∏–∫—é—Ä üå∏",
  "–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞, –∫—Ä–∞—Å–∞–≤–∏—Ü–∞! üòò"
],

  design: [
  "–î–µ—Ä–∂–∏ –ø–æ–¥–±–æ—Ä–∫—É —Å–≤–µ–∂–∏—Ö –∏–¥–µ–π –¥–∏–∑–∞–π–Ω–∞: <link> üé®",
  "–í–¥–æ—Ö–Ω–æ–≤–ª—è–π—Å—è: –≤–æ—Ç –æ—Ç–ª–∏—á–Ω—ã–π Pinterest-–∞–ª—å–±–æ–º! ‚ú®",
  "–°–º–æ—Ç—Ä–∏ —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ —ç—Ç–æ–π –¥–æ—Å–∫–µ üåà",
  "–ù—É–∂–µ–Ω —ç—Ñ—Ñ–µ–∫—Ç ¬´–≤–∞—É¬ª? –í–æ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—è –∏–¥–µ–π üíé"
],

  fallback: [
  "–ò–∑–≤–∏–Ω–∏, –Ω–µ –ø–æ–Ω—è–ª–∞‚Ä¶ –ú–æ–∂–µ—à—å –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å? ü§î",
  "–•–º–º‚Ä¶ –î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º –∏–Ω–∞—á–µ? üôà",
  "–ù–µ —É–≤–µ—Ä–µ–Ω–∞, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–ª–æ–≤–∏–ª–∞ –º—ã—Å–ª—å üôÉ",
  "–ü–æ–ø—Ä–æ–±—É–π —Å–∫–∞–∑–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É, —è –ø–æ–º–æ–≥—É! üíñ"
]
};

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–Ω—Ç–∞
 */
export function randomReply(type) {
  const arr = replies[type] || replies.fallback;
  return arr[Math.floor(Math.random() * arr.length)];
}

/**
 * –≠–º–æ–¥–∑–∏ –§–æ–∫—Å–∏ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é)
 */
export function emoji(mood = "neutral") {
  return "ü¶ä";
}
