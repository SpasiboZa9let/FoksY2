// foxy/core/intents.js

import { normalize } from "./utils.js";

const intentMatchers = {
  greeting:        ["привет", "хай", "здравствуй", "здарова", "ку", "прив", "добрый день", "доброе утро", "вечер добрый"],
  design:          ["дизайн", "рисунок", "узор", "пример", "вдохновение", "покажи идеи", "варианты"],
  confirmBooking:  ["запиши", "хочу записаться", "давай запишемся", "можно записаться", "хочу прийти"],
  showSomething:   ["покажи", "посмотреть", "что входит", "что есть", "варианты", "что предлагаешь", "уточни"],
  confirm:         ["да", "ага", "ок", "хорошо", "точно", "давай", "ясно", "понятно"],
  abilities:       ["что ты умеешь", "что можешь", "что умеешь", "расскажи о себе", "твои функции"],
  booking:         ["запись", "записаться", "забронировать", "где записаться", "как попасть", "хочу"],  // ← добавлено "хочу"
  mood:            ["настроение", "подбери", "что подойдет", "по настроению", "нюд", "кошачий глаз", "втирка", "блёстки", "глиттер", "сделай красиво"],
  thanks:          ["спасибо", "благодарю", "благодарен", "спасибки"],
  bye:             ["пока", "до свидания", "до встречи", "увидимся", "прощай", "бай"],
  smalltalkLite:   ["как дела", "чем занимаешься", "что нового", "как ты"],
  softWarning:     ["заткнись", "заткнись уже", "хватит", "не говори так", "хуй"],  // ← добавлено "хуй"
  styleTalk:       ["что модно", "тренды", "в моде", "модно", "актуально"],
  about:           ["кто ты", "ты кто", "что ты такое", "расскажи кто ты"],
  calc: ["расчёт", "посчитать", "скидка", "если цена", "калькулятор", "если у меня"],
  promoHint: [
  "я уже записана", "я была", "я записывалась", "отработала", "уже была",
  "как получить баллы", "как заработать баллы", "когда начисляешь", "баллы за визит"
],
  showServices:    ["услуги", "маникюр", "цены", "прайс", "что делаешь", "покажи услуги", "хочу другое"],
  help:            ["помоги", "не понимаю", "не знаю", "выбери за меня", "что выбрать"],
  points: [
  "баллы", "балл", "звезда", "звезды", "бонус", "награда", "прогресс",
  "сколько у меня баллов", "у меня сколько баллов", "мои баллы", "мой прогресс",
  "покажи баллы", "баланс", "сколько осталось", "сколько накопилось"
],

  // уточняющие вопросы
  inquireDetails:  ["сколько стоит", "цена", "подробн", "узна", "покажи", "уточни", "а где", "а когда", "можно", "это с"]
};

export function matchIntent(input) {
  const normalized = normalize(input);
  const words = normalized.split(/\s+/);

  for (const [intent, patterns] of Object.entries(intentMatchers)) {
    for (const rawPattern of patterns) {
      const pattern = normalize(rawPattern);

      if (pattern.includes(" ")) {
        // многословные фразы ищем как подстроку
        if (normalized.includes(pattern)) return intent;
      } else {
        // одиночные слова — точное совпадение в массивах слов
        if (words.includes(pattern)) return intent;
      }
    }
  }

  return null;
}
